<%
  require 'date'
  @deposits = @payments.map(&:advanced_amount).sum
  @withdrawls = @payments.map(&:amount_deducted).sum
  @balance = @deposits - @withdrawls
%>

<h1><%= @contact.first_name %> <%= @contact.last_name %></h1>
<%= link_to '<-- Go back', contacts_path %>
<ul>
  <li>Address: <%= @contact.address %> <%= @contact.city %> <%= @contact.state_or_province %> <%= @contact.postal_code %></li>
  <li>Home: <%= @contact.home_phone %></li>
  <li>Mobile: <%= @contact.mobile_phone %></li>
  <li>Notes: <%= @contact.notes %></li>
  <li>Paid In Full: <%= @contact.paid_in_full %></li>
  <li>Email: <%= @contact.email %></li>
</ul>
<%= link_to 'Edit Contact', edit_contact_path(@contact) %>

<h2>Balance</h2>
<p><%= number_to_currency(@balance)%></p>

<h2>Add a payment:</h2>
<%= form_with model: [ @contact, @contact.payments.build ] do |form| %>
  <p>
    <%= form.label :advanced_amount %><br>
    <%= form.text_field :advanced_amount %>
  </p>
  <p>
    <%= form.label :deducted_from_bl %><br>
    <%= form.text_field :deducted_from_bl %>
  </p>
  <p>
    <%= form.label :amount_deducted %><br>
    <%= form.text_field :amount_deducted %>
  </p>
  <p>
    <%= form.label :total_rebate %><br>
    <%= form.text_field :total_rebate %>
  </p>
  <p>
    <%= form.submit %>
  </p>
<% end %>

<h2>Payments</h2>
<% @payments.each do |payment| %>
  <ul>
    <li>ID: <%= payment.id %></li>
    <li>Date: <%= payment.payment_date&.strftime("%B %d, %Y, %A") %></li>
    <li>Advanced Amount: <%= number_to_currency(payment.advanced_amount) %></li>
    <li>Deducted From BL: <%= payment.deducted_from_bl %></li>
    <li>Amount Deducted: <%= number_to_currency(payment.amount_deducted) %></li>
    <li>Total Rebate: <%= number_to_currency(payment.total_rebate) %></li>
    <li>Edit / Delete</li>
  </ul>
<% end %>